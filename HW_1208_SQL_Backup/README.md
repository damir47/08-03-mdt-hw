### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 
Необходимо описать, какие варианты резервного копирования подходят в случаях: 
1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.
1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.
1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.
*Приведите ответ в свободной форме.*

#### Решение 1
```
1.1 Фулл + дифференциальный бекап или фулл + инкриментный. Оба варианта применимы. Принимать решение в зависимости от объема и производительности прода/срк.
1.2 Фулл + инкриментный. Дифф бекапы раз в час будут занимать слишком много места.
1.3. Да, использовать master/master или master/slave + обвязку скриптами по проверкам целостности и доступности данных и автоматического переключения.
Можно дополнительно перед базой поставить балансировщик или технологии вроде etcd/patroni для pg, типа Active Data Guard / Real Application Cluster для Oracle
```

---

### Задание 2. PostgreSQL
2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).
2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?
*Приведите ответ в свободной форме.*

#### Решение 2
```
2.1 
- Резервное копирование и восстановление через файл SQL-скрпита:
    $ pg_dump mydb > db.sql
    $ psql -X -d newdb -f db.sql

- Резервное копирование и восстановление через dump файл:
    https://postgrespro.ru/docs/postgresql/14/app-pgdump
    pg_dump [параметр-подключения...] [параметр...] [имя_бд]
    $ pg_dump -Fc mydb > db.dump

    https://postgrespro.ru/docs/postgresql/14/app-pgrestore
    pg_restore [параметр-подключения...] [параметр...] [имя_файла]
    $ pg_restore -C -d postgres db.dump

- Еще вариант через pg_basebackup, если делается копия кластера
    https://postgrespro.ru/docs/postgresql/9.6/app-pgbasebackup
    pg_basebackup [параметр...]
    $ pg_basebackup -h mydbserver -D /usr/local/pgsql/data
    Восстановление описано тут:
    https://freshbrewed.science/2023/05/22/PG-Backup.html

2.2  Можно. Самый простой способ - задание описать в shell/bash-скрипте и реализовать CRON задание + нотификацию в систему мониторинга после успешного выполнения бекапа
    https://habr.com/ru/articles/595641/ | В этой же статье интересный тред о сравнении pg_dump и pg_basebackup
```

---

### Задание 3. MySQL
3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 
3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?
*Приведите ответ в свободной форме.*

#### Решение 2
```
3.1 https://dev.mysql.com/doc/mysql-enterprise-backup/4.1/en/mysqlbackup.incremental.html

    mysqlbackup --defaults-file=/home/dbadmin/my.cnf \
    --incremental --incremental-base=history:last_backup \
    --backup-dir=/home/dbadmin/temp_dir \
    --backup-image=incremental_image1.bi \
    backup-to-image

3.2 Реплика и резервное копирование не взаимозаменяемые технологии.
Задача репликации - обеспечение высокой доступности (High availability, HA), т.е. обепечить доступность базы при выходе ноды из строя. Она абсолютно не защитит от логического повреждения базы (было на практике - поднимали из бекапа).
Задача резервного копирования - обеспечить сохранность данных и показатели RPO (Recovery Point Objective). В зависимости от того, когда сделали поледний бекап.

Если же мы все же решили исключить логическое разрушение, то на базу реплики можно переключиться быстрее (мгновенно если master-master), чем поднять сервер из бекапа.

```
